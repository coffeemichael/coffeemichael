<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>마이클리뷰 거리순</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  .shop { margin-bottom: 20px; display: flex; align-items: center; }
  .shop img { width: 80px; height: 80px; border-radius: 8px; margin-right: 12px; }
</style>
</head>
<body>

<h1>마이클리뷰 거리순 (예시 10개 + 이미지)</h1>
<div id="shop-list">불러오는 중...</div>

<script>
const API_KEY = "357B35E8-AEBD-33AD-981C-F87C4112052C";

const shops = [
  { name: "Lowkey", address: "서울 성동구 연무장3길 6", img: "1.png" },
  { name: "Coffee Graffiti", address: "서울 영등포구 양평로28다길 3", img: "2.png" },
  { name: "Gimisa", address: "서울 성동구 성수이로26길 47", img: "3.png" },
  { name: "The Barn", address: "서울 성동구 뚝섬로17길 31-22", img: "4.png" },
  { name: "Center Coffee", address: "서울 성동구 서울숲2길 28-11", img: "5.png" },
  { name: "Coffee Montage", address: "서울 강동구 올림픽로48길 23-12", img: "6.png" },
  { name: "Peer Coffee", address: "서울 성동구 광나루로4가길 24", img: "7.png" },
  { name: "Gary Gristmill", address: "서울 강남구 압구정2길 15", img: "8.png" },
  { name: "Tailor Coffee", address: "서울 강남구 강남대로160길 31", img: "9.png" },
  { name: "Biroso Coffee", address: "서울 마포구 광성로6길 42", img: "10.png" }
];

function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371; // km
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2) ** 2 +
            Math.cos(lat1 * Math.PI/180) * Math.cos(lat2 * Math.PI/180) *
            Math.sin(dLon/2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return (R * c).toFixed(2);
}

function getCoords(shop, callback) {
  $.ajax({
    url: "https://api.vworld.kr/req/address",
    type: "GET",
    dataType: "jsonp",
    data: {
      service: "address",
      request: "GetCoord",
      version: "2.0",
      crs: "EPSG:4326",
      type: "ROAD",
      address: shop.address,
      format: "json",
      errorformat: "json",
      key: API_KEY
    },
    success: function(result) {
      if (result.response?.status === "OK") {
        shop.lat = parseFloat(result.response.result.point.y);
        shop.lon = parseFloat(result.response.result.point.x);
      }
      callback();
    }
  });
}

function renderList(myLat, myLon) {
  $("#shop-list").empty();
  shops.forEach(shop => {
    if (shop.lat && shop.lon) {
      shop.distance = getDistance(myLat, myLon, shop.lat, shop.lon);
    } else {
      shop.distance = "??";
    }
  });
  shops.sort((a, b) => parseFloat(a.distance) - parseFloat(b.distance));
  shops.forEach(shop => {
    $("#shop-list").append(
      `<div class="shop">
        <img src="${shop.img}" alt="${shop.name}">
        <div>
          <b>${shop.name}</b><br>
          ${shop.distance} km
        </div>
      </div>`
    );
  });
}

function init() {
  if (!navigator.geolocation) {
    alert("위치 정보를 가져올 수 없습니다.");
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    const myLat = pos.coords.latitude;
    const myLon = pos.coords.longitude;

    let loaded = 0;
    shops.forEach(shop => {
      getCoords(shop, () => {
        loaded++;
        if (loaded === shops.length) {
          renderList(myLat, myLon);
        }
      });
    });
  });
}

init();
</script>

</body>
</html>